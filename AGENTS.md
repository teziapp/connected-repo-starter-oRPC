# Agent Guidelines for Coding Agents

## Commands
- **Dev**: `yarn dev` (all), `cd apps/backend && yarn dev`, `cd apps/frontend && yarn dev`
- **Build**: `yarn build` (all), `cd apps/backend && yarn build`, `cd apps/frontend && yarn build`
- **Lint/Format**: `yarn lint`, `yarn format` (Biome: tabs, 100 chars, double quotes)
- **Type Check**: `yarn check-types` (all workspaces)
- **Database**: `cd apps/backend && yarn db g <name>` (generate migration), `yarn db up` (apply migrations)
- **Tests**: No test suite configured - when adding tests, add scripts to app `package.json` and configure in `turbo.json`
- **Auth**: Better Auth integration with Google OAuth with transaction support using orchid-adapter

## Code Style (Biome + TypeScript Strict)
- **Formatting**: Tabs (NOT spaces), 100 char line width, double quotes, auto-organize imports
- **Types**: NO `any` or `as unknown` - use strict TypeScript, infer types from Zod schemas
- **Imports**: Direct imports from packages (e.g., `import { Button } from '@connected-repo/ui-mui/form/Button'`), NO barrel exports/index files
- **Naming**: camelCase (code), snake_case (database tables/columns), descriptive IDs (`userId` not `id`), descriptive FKs (`authorUserId` not `authorId`)
- **Error Handling**: Throw standard errors - centralized error formatter handles conversion to HTTP responses
- **Comments**: Avoid unless necessary for complex logic

## Architecture Patterns

### Database Tables (Orchid ORM)
1. Create table definition in module: `apps/backend/src/modules/<module-name>/tables/<entity>.table.ts` extending `BaseTable` with snake_case columns
   - Example: `apps/backend/src/modules/users/users/users.table.ts`
   - Example: `apps/backend/src/modules/journal-entries/tables/journal_entries.table.ts`
2. Create Zod schemas in `packages/zod-schemas/src/<entity>.zod.ts`:
   - `<entity>MandatoryZod` (required fields), `<entity>OptionalZod` (nullable fields), `<entity>AutoGeneratedZod` (IDs, timestamps)
   - Export `<entity>CreateInputZod`, `<entity>UpdateInputZod`, `<entity>SelectAllZod`
3. Register table in `apps/backend/src/db/db.ts`
4. Run migrations: `cd apps/backend && yarn db g <migration_name> && yarn db up`

**Table Organization**:
- Tables are organized by module/feature in `modules/<module-name>/tables/`
- Each module contains its related database tables, routers, and business logic
- This keeps related code together and improves maintainability

### oRPC Endpoints
- Use `publicProcedure` (unauthenticated) or `protectedProcedure` (authenticated) from `apps/backend/src/procedures/`
- Add to `apps/backend/src/router.ts` with `.input()` using Zod schemas from `@connected-repo/zod-schemas`
- Frontend auto-gets types via `BackendRouter` import - NO manual codegen needed

### Frontend (React 19 + Vite + TanStack Query)
- Import backend router type: `import type { BackendRouter } from '../../backend/src/router'`
- Use oRPC hooks: `orpc.<endpoint>.useQuery()`, `orpc.<endpoint>.useMutation()`
- Import UI from `@connected-repo/ui-mui/<category>/<Component>` (direct file imports)
- Authentication via Better Auth client
