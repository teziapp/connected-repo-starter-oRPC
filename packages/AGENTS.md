# Packages - CLAUDE.md

This file provides high-level guidance for working with shared packages in this monorepo.

## Architecture Principles

All packages follow strict architectural guidelines for **optimal build performance**:

### üö´ No Barrel Exports
- **NEVER** create `index.ts` files that re-export everything
- Each file exports independently
- Import directly from specific files: `import { Button } from '@connected-repo/ui-mui/form/Button'`
- Enables proper tree-shaking by bundlers

### üå≤ Tree-Shaking Optimized
- All packages: `"sideEffects": false` in package.json
- Only imported code gets bundled
- Significantly smaller production bundles

### üì¶ Direct File Exports
- Package exports configured via package.json `exports` field
- Pattern enforced by configuration, not documentation

### üîó Internal Package Imports
- **Within a package**: Use relative imports (`./ComponentName`, `../folder/ComponentName`)
- **Between packages**: Use package exports (`@connected-repo/package-name/path/Component`)
- This ensures proper module resolution and prevents circular dependencies

**Example**:
```typescript
// ‚úÖ Correct - Internal imports within ui-mui package
// File: packages/ui-mui/src/rhf-form/FormProvider.tsx
import { NumLockAlert } from "../feedback/NumLockAlert";
import { FormErrorDisplayer } from "./FormErrorDisplayer";

// ‚úÖ Correct - External imports from other packages
// File: apps/frontend/src/components/MyForm.tsx
import { RhfFormProvider } from '@connected-repo/ui-mui/rhf-form/FormProvider';

// ‚ùå Wrong - Don't use package alias for internal imports within the same package
// File: packages/ui-mui/src/rhf-form/FormProvider.tsx
import { NumLockAlert } from "@ui-mui/feedback/NumLockAlert"; // BAD
```

## Available Packages

### 1. @connected-repo/typescript-config
Shared TypeScript configurations for consistent compiler settings across the monorepo.

**Available Configs**:
- `base.json` - Core TypeScript settings with strict mode enabled
- `library.json` - For shared library packages (extends base, adds library-specific settings)
- `react-library.json` - For React component libraries (extends library, adds JSX support)
- `vite.json` - For Vite-based applications (extends base, optimized for Vite bundler)

**Config Hierarchy**:
```
base.json
‚îú‚îÄ‚îÄ library.json
‚îÇ   ‚îî‚îÄ‚îÄ react-library.json
‚îî‚îÄ‚îÄ vite.json
```

**Usage Examples**:
```json
// For library packages (ui-mui, zod-schemas)
{
  "extends": "@connected-repo/typescript-config/library.json"
}

// For React component libraries
{
  "extends": "@connected-repo/typescript-config/react-library.json"
}

// For Vite applications (frontend app)
{
  "extends": "@connected-repo/typescript-config/vite.json"
}
```

### 2. @connected-repo/zod-schemas
Shared Zod validation schemas with structured pattern for entities and utilities.

**Schema Structure Pattern**:
Each entity follows consistent pattern:
- `<entity>MandatoryZod` - Required fields
- `<entity>OptionalZod` - Optional/nullable fields
- `<entity>AutoGeneratedZod` - DB-generated (IDs, timestamps)
- `<entity>CreateInputZod` - Create operation input
- `<entity>UpdateInputZod` - Update operation input (all partial)
- `<entity>SelectAllZod` - Complete entity shape
- Query schemas: `<entity>GetByIdZod`, `<entity>GetByXZod`

**Import Pattern**:
```typescript
import { userCreateInputZod, userGetByIdInputZod } from '@connected-repo/zod-schemas/user.zod'
import { postCreateInputZod, postSelectAllZod } from '@connected-repo/zod-schemas/post.zod'
import { zString, zPrice, zGSTIN, zTimestamps } from '@connected-repo/zod-schemas/zod_utils'
import { NodeEnv } from '@connected-repo/zod-schemas/node_env'
```

üìñ **See [zod-schemas/AGENTS.md](./zod-schemas/AGENTS.md) for detailed validator documentation**

### 3. @connected-repo/ui-mui
Material-UI component library with direct exports and RHF components.

**Import Pattern**:
```typescript
import { Button } from '@connected-repo/ui-mui/form/Button'
import { Card } from '@connected-repo/ui-mui/layout/Card'
import { Alert } from '@connected-repo/ui-mui/feedback/Alert'
import { RhfTextField } from '@connected-repo/ui-mui/rhf-form/RhfTextField'
```

üìñ **See [ui-mui/AGENTS.md](./ui-mui/AGENTS.md) for component catalog and usage**

## Quick Reference

### Import Rules
```typescript
// ‚úÖ Correct - Direct imports from specific files
import { Button } from '@connected-repo/ui-mui/form/Button'
import { userCreateInputZod } from '@connected-repo/zod-schemas/user.zod'
import { zString, zPrice } from '@connected-repo/zod-schemas/zod_utils'

// ‚ùå Wrong - Package root imports (won't work)
import { Button } from '@connected-repo/ui-mui'
import * as schemas from '@connected-repo/zod-schemas'
```

### Build Commands
```bash
# Build all packages
yarn build

# Build specific package
cd packages/ui-mui && yarn build

# Development watch mode
cd packages/ui-mui && yarn dev
```

## Adding a New Package

1. Create directory: `packages/my-package/`
2. Add package.json with `"sideEffects": false`
3. Configure `exports` field (no index.ts)
4. Create tsconfig.json extending base
5. Add to root workspaces

**Template package.json**:
```json
{
  "name": "@connected-repo/my-package",
  "type": "module",
  "sideEffects": false,
  "exports": {
    "./*": {
      "types": "./src/*.ts",
      "import": "./dist/*.js"
    }
  }
}
```

## Bundle Size Impact

```typescript
// With barrel exports: ~500KB (bundles everything)
import { Button } from '@repo/ui'

// Direct imports: ~5KB (bundles only Button)
import { Button } from '@repo/ui/form/Button'
```

## Troubleshooting

**"Cannot find module" error**:
1. Run `yarn build` in the package
2. Verify exports in package.json
3. Restart TypeScript server

**Tree-shaking not working**:
1. Check `"sideEffects": false`
2. Use direct imports, not barrel exports
3. Verify `"type": "module"`

---

üìñ For detailed package documentation, see individual package AGENTS.md files.
