import z from "zod";
import { zSmallint, zString, zTimestamps } from "./zod_utils.js";

const teamAutoGeneratedZod = z.object({
  teamId: z.uuid(),
});

const teamMandatoryZod = z.object({
  allowedDomains: z.array(zString).default([]),
  allowedIPs: z.array(zString).default([]),
  apiSecretHash: zString,
  name: zString,
  rateLimitPerMinute: zSmallint(),
});

const teamOptionalZod = z.object({
  subscriptionAlertWebhookUrl: z.url().nullable(),
  subscriptionAlertWebhookBearerToken: zString.nullable(),
});

export const teamCreateInputZod = teamMandatoryZod.extend(teamOptionalZod.partial().shape)
  .omit({
    apiSecretHash: true,
  })
  .extend({
    apiSecretKey: zString.min(1, "API Secret Key is required")
  });
export type TeamCreateInput = z.infer<typeof teamCreateInputZod>;

export const teamUpdateInputZod = teamMandatoryZod
  .extend(teamOptionalZod.shape)
  .extend(teamAutoGeneratedZod.shape)
  .extend(zTimestamps)
  .omit({
    apiSecretHash: true,
    rateLimitPerMinute: true,
    subscriptionAlertWebhookBearerToken: true,
  })
  .partial();
export type TeamUpdateInput = z.infer<typeof teamUpdateInputZod>;

export const teamSelectAllZod = teamMandatoryZod
  .extend(teamOptionalZod.shape)
  .extend(teamAutoGeneratedZod.shape)
  .extend(zTimestamps)
  .omit({
    apiSecretHash: true,
    subscriptionAlertWebhookBearerToken: true,
  });
export type TeamSelectAll = z.infer<typeof teamSelectAllZod>;

export const teamGetByIdInputZod = teamAutoGeneratedZod;